# ç‰¹å¾å¯è§†åŒ–ä½¿ç”¨è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

`visualize_features.py` è„šæœ¬ç”¨äºåˆ†ææ­£é¢ç‰¹å¾å’Œä¾§é¢ç‰¹å¾çš„åˆ†å¸ƒç›¸ä¼¼æ€§ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„å¯è§†åŒ–å›¾ç‰‡ã€‚

### ä¸»è¦åŠŸèƒ½

1. **ç‰¹å¾æå–**: ä»è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­æå–ä¾§é¢ç‰¹å¾å’Œæ­£é¢ç‰¹å¾
2. **ç›¸ä¼¼æ€§åˆ†æ**: è®¡ç®—å¤šç§ç›¸ä¼¼æ€§æŒ‡æ ‡
   - Pearsonç›¸å…³ç³»æ•°ï¼ˆé€ç»´åº¦ï¼‰
   - å‡å€¼å·®å¼‚
   - æ–¹å·®æ¯”ç‡
   - ä½™å¼¦ç›¸ä¼¼åº¦
   - KLæ•£åº¦
3. **å¯è§†åŒ–ç”Ÿæˆ**: ç”Ÿæˆ5ç§ä¸åŒç±»å‹çš„å¯è§†åŒ–å›¾ç‰‡

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```bash
# ä½¿ç”¨ç®€å•ä¸‰å…ƒç»„ç½‘ç»œæ¨¡å‹
python train_transformer3D/triplet/visualize_features.py \
    --model_path train_transformer3D/checkpoints/best_model_simple_triplet.pth \
    --model_type simple \
    --data_dir train/datas/file \
    --num_samples 1000 \
    --batch_size 64
```

### ä½¿ç”¨Transformeræ¨¡å‹

```bash
python train_transformer3D/triplet/visualize_features.py \
    --model_path train_transformer3D/checkpoints/best_model.pth \
    --model_type transformer \
    --data_dir train/datas/file \
    --num_samples 1000
```

### å®Œæ•´å‚æ•°

```bash
python train_transformer3D/triplet/visualize_features.py \
    --model_path train_transformer3D/checkpoints/best_model_simple_triplet.pth \
    --model_type simple \
    --data_dir train/datas/file \
    --batch_size 64 \
    --num_samples 1000 \
    --image_dim 512 \
    --top_k 50 \
    --save_dir train_transformer3D/triplet/feature_visualizations \
    --device cuda
```

## ğŸ“Š ç”Ÿæˆçš„å¯è§†åŒ–å›¾ç‰‡

è„šæœ¬ä¼šç”Ÿæˆä»¥ä¸‹5ç§å¯è§†åŒ–å›¾ç‰‡ï¼š

### 1. `feature_correlation_analysis.png`
- **æœ€ç›¸ä¼¼çš„kä¸ªç»´åº¦ç›¸å…³æ€§çŸ©é˜µ**: çƒ­åŠ›å›¾æ˜¾ç¤ºæœ€ç›¸ä¼¼ç»´åº¦ä¹‹é—´çš„ç›¸å…³æ€§
- **ç›¸å…³æ€§åˆ†å¸ƒç›´æ–¹å›¾**: æ‰€æœ‰ç»´åº¦ç›¸å…³æ€§çš„åˆ†å¸ƒ
- **æœ€ç›¸ä¼¼ç»´åº¦ç‰¹å¾åˆ†å¸ƒå¯¹æ¯”**: ç›´æ–¹å›¾å¯¹æ¯”
- **æœ€ä¸ç›¸ä¼¼ç»´åº¦ç‰¹å¾åˆ†å¸ƒå¯¹æ¯”**: ç›´æ–¹å›¾å¯¹æ¯”

### 2. `feature_similarity_analysis.png`
- **ç›¸å…³æ€§æ’åº**: æ‰€æœ‰ç»´åº¦æŒ‰ç›¸å…³æ€§æ’åºçš„æŠ˜çº¿å›¾
- **å‡å€¼å·®å¼‚**: å‰50ä¸ªç»´åº¦å‡å€¼å·®å¼‚çš„æŸ±çŠ¶å›¾
- **æ–¹å·®æ¯”ç‡**: å‰50ä¸ªç»´åº¦æ–¹å·®æ¯”ç‡çš„æŸ±çŠ¶å›¾
- **ä½™å¼¦ç›¸ä¼¼åº¦**: å‰50ä¸ªç»´åº¦ä½™å¼¦ç›¸ä¼¼åº¦çš„æŸ±çŠ¶å›¾

### 3. `feature_distribution_comparison.png`
- **6ä¸ªä»£è¡¨æ€§ç»´åº¦**: æœ€ç›¸ä¼¼çš„3ä¸ªå’Œæœ€ä¸ç›¸ä¼¼çš„3ä¸ªç»´åº¦çš„åˆ†å¸ƒå¯¹æ¯”

### 4. `feature_scatter_plots.png`
- **æœ€ç›¸ä¼¼ç»´åº¦æ•£ç‚¹å›¾**: ä¾§é¢ç‰¹å¾ vs æ­£é¢ç‰¹å¾
- **æœ€ä¸ç›¸ä¼¼ç»´åº¦æ•£ç‚¹å›¾**: ä¾§é¢ç‰¹å¾ vs æ­£é¢ç‰¹å¾

### 5. `feature_heatmaps.png`
- **ä¾§é¢ç‰¹å¾çƒ­åŠ›å›¾**: æ‰€æœ‰æ ·æœ¬çš„æ‰€æœ‰ç»´åº¦ï¼ˆæŒ‰ç›¸å…³æ€§æ’åºï¼‰
- **æ­£é¢ç‰¹å¾çƒ­åŠ›å›¾**: æ‰€æœ‰æ ·æœ¬çš„æ‰€æœ‰ç»´åº¦ï¼ˆæŒ‰ç›¸å…³æ€§æ’åºï¼‰

### 6. `feature_statistics.txt`
- **ç»Ÿè®¡ä¿¡æ¯æ–‡æœ¬æ–‡ä»¶**: åŒ…å«è¯¦ç»†çš„æ•°å€¼ç»Ÿè®¡

## ğŸ“ˆ è¾“å‡ºç¤ºä¾‹

```
ä½¿ç”¨è®¾å¤‡: cuda
åŠ è½½æ•°æ®...
âœ“ æ•°æ®åŠ è½½å®Œæˆ: 1000 ä¸ªæ ·æœ¬
åŠ è½½æ¨¡å‹: train_transformer3D/checkpoints/best_model_simple_triplet.pth
âœ“ æ¨¡å‹åŠ è½½å®Œæˆ

æå–ç‰¹å¾...
æå–å®Œæˆ: 1000 ä¸ªæ ·æœ¬
  ä¾§é¢ç‰¹å¾å½¢çŠ¶: (1000, 512)
  æ­£é¢ç‰¹å¾å½¢çŠ¶: (1000, 512)
  èº«ä»½ç‰¹å¾å½¢çŠ¶: (1000, 512)

è®¡ç®—ç‰¹å¾ç›¸ä¼¼æ€§...
âœ“ ç›¸ä¼¼æ€§è®¡ç®—å®Œæˆ
  å¹³å‡ç›¸å…³ç³»æ•°: 0.8234

ç”Ÿæˆå¯è§†åŒ–å›¾ç‰‡...
âœ“ å·²ä¿å­˜: feature_correlation_analysis.png
âœ“ å·²ä¿å­˜: feature_similarity_analysis.png
âœ“ å·²ä¿å­˜: feature_distribution_comparison.png
âœ“ å·²ä¿å­˜: feature_scatter_plots.png
âœ“ å·²ä¿å­˜: feature_heatmaps.png
âœ“ å·²ä¿å­˜: feature_statistics.txt

âœ“ æ‰€æœ‰å¯è§†åŒ–å›¾ç‰‡å·²ä¿å­˜åˆ°: train_transformer3D/triplet/feature_visualizations
```

## ğŸ” å¦‚ä½•è§£è¯»ç»“æœ

### 1. ç›¸å…³æ€§åˆ†æ

- **é«˜ç›¸å…³æ€§ï¼ˆæ¥è¿‘1ï¼‰**: è¯¥ç»´åº¦åœ¨æ­£é¢å’Œä¾§é¢ç‰¹å¾ä¸­åˆ†å¸ƒç›¸ä¼¼ï¼Œå¯èƒ½æ˜¯èº«ä»½ç›¸å…³çš„ç‰¹å¾
- **ä½ç›¸å…³æ€§ï¼ˆæ¥è¿‘0æˆ–è´Ÿå€¼ï¼‰**: è¯¥ç»´åº¦åœ¨æ­£é¢å’Œä¾§é¢ç‰¹å¾ä¸­åˆ†å¸ƒå·®å¼‚å¤§ï¼Œå¯èƒ½æ˜¯è§’åº¦ç›¸å…³çš„ç‰¹å¾

### 2. åˆ†å¸ƒå¯¹æ¯”

- **é‡å åº¦é«˜**: ä¸¤ä¸ªåˆ†å¸ƒé‡å å¤šï¼Œè¯´æ˜è¯¥ç»´åº¦ç›¸ä¼¼
- **é‡å åº¦ä½**: ä¸¤ä¸ªåˆ†å¸ƒå·®å¼‚å¤§ï¼Œè¯´æ˜è¯¥ç»´åº¦ä¸ç›¸ä¼¼

### 3. æ•£ç‚¹å›¾

- **æ¥è¿‘y=xçº¿**: è¯´æ˜è¯¥ç»´åº¦åœ¨æ­£é¢å’Œä¾§é¢ç‰¹å¾ä¸­å€¼ç›¸è¿‘
- **åç¦»y=xçº¿**: è¯´æ˜è¯¥ç»´åº¦åœ¨æ­£é¢å’Œä¾§é¢ç‰¹å¾ä¸­å€¼å·®å¼‚å¤§

### 4. çƒ­åŠ›å›¾

- **é¢œè‰²æ¨¡å¼ç›¸ä¼¼**: è¯´æ˜ä¸¤ä¸ªç‰¹å¾åœ¨æ•´ä½“ä¸Šåˆ†å¸ƒç›¸ä¼¼
- **é¢œè‰²æ¨¡å¼å·®å¼‚å¤§**: è¯´æ˜ä¸¤ä¸ªç‰¹å¾åœ¨æ•´ä½“ä¸Šåˆ†å¸ƒå·®å¼‚å¤§

## âš™ï¸ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--model_path` | æ¨¡å‹æ£€æŸ¥ç‚¹è·¯å¾„ | **å¿…éœ€** |
| `--model_type` | æ¨¡å‹ç±»å‹ï¼ˆsimple/transformerï¼‰ | simple |
| `--data_dir` | æ•°æ®ç›®å½• | train/datas/file |
| `--batch_size` | æ‰¹æ¬¡å¤§å° | 64 |
| `--num_samples` | åˆ†æçš„æ ·æœ¬æ•°é‡ | 1000 |
| `--image_dim` | å›¾åƒç‰¹å¾ç»´åº¦ | 512 |
| `--top_k` | æ˜¾ç¤ºå‰kä¸ªæœ€ç›¸ä¼¼/æœ€ä¸ç›¸ä¼¼çš„ç»´åº¦ | 50 |
| `--save_dir` | ä¿å­˜ç›®å½• | train_transformer3D/triplet/feature_visualizations |
| `--device` | è®¾å¤‡ï¼ˆcuda/cpuï¼‰ | cudaï¼ˆå¦‚æœå¯ç”¨ï¼‰ |

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **æ ·æœ¬æ•°é‡**: å»ºè®®ä½¿ç”¨1000-5000ä¸ªæ ·æœ¬ï¼Œå¤ªå°‘å¯èƒ½ä¸å¤Ÿç»Ÿè®¡ï¼Œå¤ªå¤šå¯èƒ½è®¡ç®—æ…¢
2. **æ‰¹æ¬¡å¤§å°**: æ ¹æ®GPUå†…å­˜è°ƒæ•´ï¼Œå»ºè®®32-128
3. **top_k**: å»ºè®®50-100ï¼Œå¤ªå°å¯èƒ½é—æ¼é‡è¦ä¿¡æ¯ï¼Œå¤ªå¤§å¯èƒ½æ˜¾ç¤ºè¿‡å¤šç»†èŠ‚

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `visualize_features.py`: å¯è§†åŒ–è„šæœ¬
- `models_simple_triplet.py`: ç®€å•ä¸‰å…ƒç»„ç½‘ç»œæ¨¡å‹
- `models_3d_triplet.py`: Transformerä¸‰å…ƒç»„ç½‘ç»œæ¨¡å‹
- `dataset_triplet.py`: æ•°æ®é›†

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä»£ç æ³¨é‡Šæˆ–æäº¤Issueã€‚

