# CLIPå§¿æ€ç¼–ç ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å°†å§¿æ€è§’åº¦ï¼ˆyaw, pitch, rollï¼‰è½¬æ¢ä¸ºæ–‡æœ¬æè¿°ï¼Œé€šè¿‡CLIPç¼–ç å™¨è·å¾—è¯­ä¹‰ä¸°å¯Œçš„å§¿æ€è¡¨ç¤ºï¼Œæ›¿ä»£ç®€å•çš„MLPç¼–ç ã€‚

---

## ğŸ“¦ å®‰è£…ä¾èµ–

é¦–å…ˆéœ€è¦å®‰è£…CLIPï¼š

```bash
pip install ftfy regex tqdm
pip install git+https://github.com/openai/CLIP.git
```

æˆ–è€…ä½¿ç”¨å›½å†…é•œåƒï¼š

```bash
pip install ftfy regex tqdm
pip install git+https://gitee.com/mirrors/CLIP.git
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯ç”¨CLIPå§¿æ€ç¼–ç å™¨

åœ¨è®­ç»ƒæ—¶æ·»åŠ  `--use_clip_pose_encoder` å‚æ•°ï¼š

```bash
C:/Users/62487/.conda/envs/llm/python.exe d:/Code/face000/train_transformer3D/train_universal.py --data_dir train/datas/file --epochs 150 --use_clip_pose_encoder
```

### 2. å¯¹æ¯”å®éªŒ

**ä½¿ç”¨MLPç¼–ç å™¨ï¼ˆé»˜è®¤ï¼‰**:
```bash
C:/Users/62487/.conda/envs/llm/python.exe d:/Code/face000/train_transformer3D/train_universal.py --data_dir train/datas/file --epochs 150
```

**ä½¿ç”¨CLIPç¼–ç å™¨**:
```bash
C:/Users/62487/.conda/envs/llm/python.exe d:/Code/face000/train_transformer3D/train_universal.py --data_dir train/datas/file --epochs 150 --use_clip_pose_encoder
```

---

## ğŸ”§ å®ç°ç»†èŠ‚

### å§¿æ€åˆ°æ–‡æœ¬çš„è½¬æ¢

å§¿æ€è§’åº¦ä¼šè¢«è½¬æ¢ä¸ºè‡ªç„¶è¯­è¨€æè¿°ï¼š

- **Yaw (å·¦å³è½¬å¤´)**:
  - `yaw < -45Â°`: "left profile view"
  - `-45Â° â‰¤ yaw < -15Â°`: "left three-quarter view"
  - `-15Â° â‰¤ yaw < 15Â°`: "frontal view"
  - `15Â° â‰¤ yaw < 45Â°`: "right three-quarter view"
  - `yaw â‰¥ 45Â°`: "right profile view"

- **Pitch (ä¸Šä¸‹æŠ¬å¤´)**:
  - `pitch < -20Â°`: "looking down"
  - `-20Â° â‰¤ pitch < 20Â°`: "level gaze"
  - `pitch â‰¥ 20Â°`: "looking up"

- **Roll (å¤´éƒ¨å€¾æ–œ)**:
  - `|roll| < 10Â°`: "upright"
  - `roll > 0`: "tilted right"
  - `roll < 0`: "tilted left"

**ç¤ºä¾‹**: `yaw=45Â°, pitch=10Â°, roll=-5Â°` â†’ `"right profile view, level gaze, tilted left"`

### CLIPç¼–ç æµç¨‹

1. **æ–‡æœ¬ç”Ÿæˆ**: å°†å§¿æ€è§’åº¦è½¬æ¢ä¸ºæ–‡æœ¬æè¿°
2. **CLIPç¼–ç **: ä½¿ç”¨CLIPæ–‡æœ¬ç¼–ç å™¨ç¼–ç æ–‡æœ¬
3. **æŠ•å½±**: é€šè¿‡æŠ•å½±å±‚å°†CLIPç¼–ç æŠ•å½±åˆ°æ¨¡å‹éœ€è¦çš„ç»´åº¦
4. **æ³¨å…¥**: å°†ç¼–ç æ³¨å…¥åˆ°Transformerçš„Qã€Kã€Vä¸­

---

## âš™ï¸ é…ç½®é€‰é¡¹

### åœ¨ä»£ç ä¸­ä¿®æ”¹

å¯ä»¥åœ¨ `pose_encoder_clip.py` ä¸­è°ƒæ•´ï¼š

1. **CLIPæ¨¡å‹å¤§å°**:
   ```python
   encoder = CLIPPoseEncoder(
       output_dim=512 * 3,
       clip_model_name='ViT-B/32',  # å¯é€‰: 'ViT-B/16', 'ViT-L/14'
       device='cuda'
   )
   ```

2. **æ˜¯å¦å†»ç»“CLIP**:
   ```python
   encoder = CLIPPoseEncoder(
       output_dim=512 * 3,
       freeze_clip=True  # True: åªè®­ç»ƒæŠ•å½±å±‚, False: å¾®è°ƒCLIP
   )
   ```

3. **æ–‡æœ¬æè¿°æ–¹å¼**:
   ```python
   encoder = CLIPPoseEncoder(
       output_dim=512 * 3,
       use_continuous_text=False  # False: ç¦»æ•£æè¿°, True: è¿ç»­æ•°å€¼æè¿°
   )
   ```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ä¼˜åŠ¿

1. **è¯­ä¹‰ä¸°å¯Œ**: CLIPçš„æ–‡æœ¬ç¼–ç åŒ…å«ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯
2. **é¢„è®­ç»ƒçŸ¥è¯†**: åˆ©ç”¨CLIPåœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šçš„é¢„è®­ç»ƒçŸ¥è¯†
3. **è·¨æ¨¡æ€å¯¹é½**: æ–‡æœ¬æè¿°ä¸è§†è§‰ç‰¹å¾æœ‰å¤©ç„¶å¯¹é½
4. **å¯è§£é‡Šæ€§**: æ–‡æœ¬æè¿°æ¯”æ•°å€¼æ›´ç›´è§‚

### å¯èƒ½çš„é—®é¢˜

1. **è®¡ç®—å¼€é”€**: CLIPç¼–ç æ¯”MLPæ…¢ï¼ˆä½†å¯ä»¥å†»ç»“CLIPå‚æ•°ï¼‰
2. **æ˜¾å­˜å ç”¨**: CLIPæ¨¡å‹éœ€è¦é¢å¤–æ˜¾å­˜ï¼ˆçº¦1-2GBï¼‰
3. **æ•ˆæœä¸ç¡®å®š**: éœ€è¦é€šè¿‡å®éªŒéªŒè¯æ˜¯å¦çœŸçš„æœ‰æ•ˆ

---

## ğŸ§ª å®éªŒå»ºè®®

### é˜¶æ®µ1ï¼šå¿«é€ŸéªŒè¯

1. åœ¨å°æ•°æ®é›†ä¸Šå¯¹æ¯”MLPå’ŒCLIPç¼–ç å™¨
2. è§‚å¯Ÿè®­ç»ƒé€Ÿåº¦å’Œæ˜¾å­˜å ç”¨
3. æ£€æŸ¥éªŒè¯é›†è¡¨ç°

### é˜¶æ®µ2ï¼šæ·±å…¥ä¼˜åŒ–

1. å°è¯•ä¸åŒçš„æ–‡æœ¬æè¿°æ–¹å¼
2. è°ƒæ•´æŠ•å½±å±‚ç»“æ„
3. è€ƒè™‘æ˜¯å¦å¾®è°ƒCLIPå‚æ•°

### é˜¶æ®µ3ï¼šæ‰©å±•åº”ç”¨

1. æ·»åŠ æ›´å¤šè¯­ä¹‰ä¿¡æ¯ï¼ˆè¡¨æƒ…ã€å…‰ç…§ç­‰ï¼‰
2. ä½¿ç”¨æ··åˆç¼–ç å™¨ï¼ˆCLIP + MLPï¼‰

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**: å»ºè®®å…ˆåœ¨å°æ•°æ®é›†ä¸Šæµ‹è¯•ï¼Œç¡®è®¤CLIPå®‰è£…æ­£ç¡®
2. **æ€§èƒ½å¯¹æ¯”**: è®°å½•ä½¿ç”¨CLIPå’Œä¸ä½¿ç”¨CLIPçš„è®­ç»ƒç»“æœï¼Œå¯¹æ¯”æ•ˆæœ
3. **æ˜¾å­˜ç®¡ç†**: å¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œå¯ä»¥ä½¿ç”¨æ›´å°çš„CLIPæ¨¡å‹ï¼ˆå¦‚ViT-B/16ï¼‰
4. **è®­ç»ƒé€Ÿåº¦**: CLIPç¼–ç ä¼šå¢åŠ è®­ç»ƒæ—¶é—´ï¼Œä½†å¯ä»¥é€šè¿‡å†»ç»“CLIPå‚æ•°å‡å°‘å½±å“

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: ImportError: CLIPæœªå®‰è£…

**è§£å†³**: 
```bash
pip install ftfy regex tqdm
pip install git+https://github.com/openai/CLIP.git
```

### é—®é¢˜2: æ˜¾å­˜ä¸è¶³

**è§£å†³**: 
- ä½¿ç”¨æ›´å°çš„CLIPæ¨¡å‹: `clip_model_name='ViT-B/16'`
- å‡å°‘batch_size
- å†»ç»“CLIPå‚æ•°ï¼ˆé»˜è®¤å·²å†»ç»“ï¼‰

### é—®é¢˜3: è®­ç»ƒé€Ÿåº¦æ…¢

**è§£å†³**: 
- ç¡®è®¤CLIPå‚æ•°å·²å†»ç»“ï¼ˆ`freeze_clip=True`ï¼‰
- è€ƒè™‘é¢„è®¡ç®—CLIPç¼–ç å¹¶ç¼“å­˜

---

## ğŸ“ æ€»ç»“

CLIPå§¿æ€ç¼–ç æ˜¯ä¸€ä¸ª**å®éªŒæ€§åŠŸèƒ½**ï¼Œç†è®ºä¸Šå¯èƒ½æœ‰ä¼˜åŠ¿ï¼Œä½†éœ€è¦é€šè¿‡å®éªŒéªŒè¯ã€‚å»ºè®®ï¼š

1. âœ… **å€¼å¾—å°è¯•**: å®ç°æˆæœ¬ä¸é«˜ï¼Œå€¼å¾—å®éªŒ
2. âš ï¸ **éœ€è¦éªŒè¯**: å®é™…æ•ˆæœéœ€è¦é€šè¿‡å¯¹æ¯”å®éªŒç¡®è®¤
3. ğŸ”§ **çµæ´»é…ç½®**: å¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶æ˜¯å¦ä½¿ç”¨ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

**å»ºè®®**: å…ˆåœ¨å°æ•°æ®é›†ä¸Šå¿«é€ŸéªŒè¯ï¼Œå¦‚æœæ•ˆæœå¥½å†åº”ç”¨åˆ°å®Œæ•´è®­ç»ƒã€‚
