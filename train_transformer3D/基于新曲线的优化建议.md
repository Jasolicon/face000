# åŸºäºŽæ–°è®­ç»ƒæ›²çº¿çš„æ·±åº¦ä¼˜åŒ–å»ºè®®

## ðŸ“Š å½“å‰è®­ç»ƒæ›²çº¿åˆ†æžï¼ˆ65ä¸ªepochï¼‰

### è§‚å¯Ÿåˆ°çš„çŽ°è±¡

1. **æŸå¤±æ”¶æ•›è‰¯å¥½**ï¼š
   - è®­ç»ƒæŸå¤±ï¼š0.15-0.16ï¼ˆç¨³å®šï¼‰
   - éªŒè¯æŸå¤±ï¼š0.22-0.23ï¼ˆç¨³å®šï¼Œç•¥é«˜äºŽè®­ç»ƒæŸå¤±ï¼‰
   - **è¿‡æ‹Ÿåˆç¨‹åº¦**ï¼šè½»å¾®ï¼ˆéªŒè¯æŸå¤±æ¯”è®­ç»ƒæŸå¤±é«˜çº¦40%ï¼Œåœ¨å¯æŽ¥å—èŒƒå›´å†…ï¼‰

2. **ä½™å¼¦ç›¸ä¼¼åº¦ç“¶é¢ˆ**ï¼š
   - å¿«é€Ÿä¸Šå‡åˆ°0.74-0.75ï¼ˆå‰20ä¸ªepochï¼‰
   - **ä¹‹åŽå‡ ä¹Žåœæ»ž**ï¼Œæ— æ³•çªç ´0.75
   - è¿™æ˜¯å½“å‰çš„ä¸»è¦é—®é¢˜

3. **æ”¶æ•›é€Ÿåº¦**ï¼š
   - å‰20ä¸ªepochå¿«é€Ÿå­¦ä¹ 
   - 20ä¸ªepochåŽè¿›å…¥å¹³å°æœŸ

## ðŸŽ¯ é’ˆå¯¹æ€§ä¼˜åŒ–ç­–ç•¥

### 1. **çªç ´ç›¸ä¼¼åº¦ç“¶é¢ˆï¼ˆ0.75 â†’ 0.85+ï¼‰**

#### é—®é¢˜è¯Šæ–­
ç›¸ä¼¼åº¦å¡åœ¨0.75å¯èƒ½çš„åŽŸå› ï¼š
- æ¨¡åž‹å®¹é‡ä¸è¶³
- æŸå¤±å‡½æ•°æƒé‡ä¸å¤Ÿä¼˜åŒ–
- å­¦ä¹ çŽ‡åœ¨å¹³å°æœŸè¿‡æ—©è¡°å‡
- ç‰¹å¾æå–è´¨é‡é™åˆ¶

#### ä¼˜åŒ–æ–¹æ¡ˆAï¼šè°ƒæ•´æŸå¤±å‡½æ•°æƒé‡ï¼ˆä¼˜å…ˆå°è¯•ï¼‰

```bash
# æ›´æ¿€è¿›çš„ä½™å¼¦æƒé‡
--mse_weight 0.1 \
--cosine_weight 0.9 \
```

**åŽŸç†**ï¼šç›¸ä¼¼åº¦æ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œéœ€è¦æ›´å¼ºè°ƒç‰¹å¾æ–¹å‘è€Œéžæ•°å€¼å·®å¼‚ã€‚

#### ä¼˜åŒ–æ–¹æ¡ˆBï¼šå¢žåŠ æ¨¡åž‹å®¹é‡

```bash
# å¢žåŠ æ¨¡åž‹ç»´åº¦
--d_model 768 \          # ä»Ž512å¢žåŠ åˆ°768
--dim_feedforward 3072 \ # ç›¸åº”å¢žåŠ ï¼ˆé€šå¸¸æ˜¯d_modelçš„4å€ï¼‰
--num_layers 6 \         # ä»Ž4å¢žåŠ åˆ°6
```

**æ³¨æ„**ï¼šè¿™ä¼šæ˜¾è‘—å¢žåŠ è®¡ç®—é‡å’Œæ˜¾å­˜å ç”¨ã€‚

#### ä¼˜åŒ–æ–¹æ¡ˆCï¼šè°ƒæ•´å­¦ä¹ çŽ‡ç­–ç•¥

```bash
# ä½¿ç”¨æ›´é•¿çš„Cosineå‘¨æœŸï¼Œé¿å…è¿‡æ—©è¡°å‡
--warmup_epochs 10 \     # å¢žåŠ warmupæ—¶é—´
--epochs 150 \           # å¢žåŠ æ€»è®­ç»ƒè½®æ•°
--cosine_eta_min 1e-5 \ # æé«˜æœ€å°å­¦ä¹ çŽ‡ï¼ˆä»Ž1e-6åˆ°1e-5ï¼‰
```

### 2. **å¤„ç†è½»å¾®è¿‡æ‹Ÿåˆ**

#### å½“å‰çŠ¶æ€
- éªŒè¯æŸå¤±/è®­ç»ƒæŸå¤± â‰ˆ 1.4ï¼ˆè½»å¾®è¿‡æ‹Ÿåˆï¼Œä½†å¯æŽ¥å—ï¼‰

#### ä¼˜åŒ–å»ºè®®

**é€‰é¡¹1ï¼šå¢žåŠ æ­£åˆ™åŒ–ï¼ˆå¦‚æžœè¿‡æ‹ŸåˆåŠ é‡ï¼‰**
```bash
--dropout 0.2 \         # ä»Ž0.15å¢žåŠ åˆ°0.2
--weight_decay 2e-4 \   # ä»Ž1e-4å¢žåŠ åˆ°2e-4
```

**é€‰é¡¹2ï¼šä¿æŒå½“å‰è®¾ç½®ï¼ˆå¦‚æžœè¿‡æ‹Ÿåˆä¸ä¸¥é‡ï¼‰**
- å½“å‰1.4çš„æ¯”çŽ‡æ˜¯åˆç†çš„ï¼Œè¯´æ˜Žæ¨¡åž‹æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›
- å¯ä»¥æš‚æ—¶ä¿æŒdropout=0.15å’Œweight_decay=1e-4

### 3. **å­¦ä¹ çŽ‡è°ƒåº¦ä¼˜åŒ–**

#### é—®é¢˜
- Cosineè°ƒåº¦å™¨å¯èƒ½åœ¨20ä¸ªepochåŽå­¦ä¹ çŽ‡é™å¾—å¤ªå¿«
- éœ€è¦æ›´é•¿çš„"é«˜å­¦ä¹ çŽ‡"é˜¶æ®µæ¥çªç ´å¹³å°æœŸ

#### ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨Cosine Annealing with Restarts

```python
# éœ€è¦ä¿®æ”¹ä»£ç å®žçŽ°ï¼Œæˆ–ä½¿ç”¨æ›´é•¿çš„Cosineå‘¨æœŸ
--scheduler_type cosine \
--warmup_epochs 10 \
--epochs 150 \
--cosine_eta_min 1e-5 \  # æé«˜æœ€å°å­¦ä¹ çŽ‡ï¼Œä¿æŒæŽ¢ç´¢èƒ½åŠ›
```

### 4. **æ‰¹æ¬¡å¤§å°ä¼˜åŒ–**

#### å½“å‰ï¼šbatch_size=32

#### ä¼˜åŒ–å»ºè®®
```bash
# å¦‚æžœæ˜¾å­˜å…è®¸ï¼Œå°è¯•æ›´å¤§çš„batch size
--batch_size 64 \        # æˆ– 128
```

**åŽŸç†**ï¼š
- æ›´å¤§çš„batch sizeæä¾›æ›´ç¨³å®šçš„æ¢¯åº¦
- æœ‰åŠ©äºŽæ¨¡åž‹è·³å‡ºå±€éƒ¨æœ€ä¼˜
- é…åˆæ··åˆç²¾åº¦è®­ç»ƒï¼Œæ˜¾å­˜å ç”¨å¯æŽ§

### 5. **æ•°æ®å¢žå¼ºï¼ˆå¦‚æžœé€‚ç”¨ï¼‰**

å¦‚æžœæ•°æ®é‡æœ‰é™ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- è½»å¾®çš„è§’åº¦æ‰°åŠ¨
- å…‰ç…§å˜åŒ–
- ä½†è¿™äº›éœ€è¦è°¨æ…Žï¼Œé¿å…ç ´å3Då…³é”®ç‚¹çš„å‡†ç¡®æ€§

## ðŸ“ æŽ¨èçš„ä¼˜åŒ–è®­ç»ƒå‘½ä»¤

### æ–¹æ¡ˆ1ï¼šæŸå¤±å‡½æ•°ä¼˜åŒ–ï¼ˆæœ€ç®€å•ï¼Œä¼˜å…ˆå°è¯•ï¼‰

```bash
python train_transformer3D/train_3d.py \
    --data_dir train/datas/file \
    --batch_size 32 \
    --epochs 150 \
    --lr 1e-4 \
    --warmup_epochs 10 \
    --warmup_lr 1e-6 \
    --scheduler_type cosine \
    --cosine_eta_min 1e-5 \
    --weight_decay 1e-4 \
    --dropout 0.15 \
    --mse_weight 0.1 \
    --cosine_weight 0.9 \
    --use_mixed_precision \
    --early_stopping_patience 20 \
    --early_stopping_min_delta 1e-4
```

**å…³é”®å˜åŒ–**ï¼š
- `--mse_weight 0.1 --cosine_weight 0.9`ï¼šæ›´å¼ºè°ƒç›¸ä¼¼åº¦
- `--warmup_epochs 10`ï¼šæ›´é•¿çš„warmup
- `--epochs 150`ï¼šæ›´å¤šè®­ç»ƒè½®æ•°
- `--cosine_eta_min 1e-5`ï¼šæ›´é«˜çš„æœ€å°å­¦ä¹ çŽ‡

### æ–¹æ¡ˆ2ï¼šå¢žåŠ æ¨¡åž‹å®¹é‡ï¼ˆå¦‚æžœæ–¹æ¡ˆ1æ•ˆæžœä¸ä½³ï¼‰

```bash
python train_transformer3D/train_3d.py \
    --data_dir train/datas/file \
    --batch_size 32 \
    --epochs 150 \
    --lr 1e-4 \
    --warmup_epochs 10 \
    --warmup_lr 1e-6 \
    --scheduler_type cosine \
    --cosine_eta_min 1e-5 \
    --d_model 768 \
    --dim_feedforward 3072 \
    --num_layers 6 \
    --weight_decay 1e-4 \
    --dropout 0.2 \
    --mse_weight 0.1 \
    --cosine_weight 0.9 \
    --use_mixed_precision \
    --early_stopping_patience 20
```

**å…³é”®å˜åŒ–**ï¼š
- `--d_model 768`ï¼šå¢žåŠ æ¨¡åž‹ç»´åº¦
- `--num_layers 6`ï¼šå¢žåŠ å±‚æ•°
- `--dropout 0.2`ï¼šç›¸åº”å¢žåŠ dropoutï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰

### æ–¹æ¡ˆ3ï¼šæ›´å¤§æ‰¹æ¬¡ + æ›´é•¿è®­ç»ƒï¼ˆå¦‚æžœæ˜¾å­˜å……è¶³ï¼‰

```bash
python train_transformer3D/train_3d.py \
    --data_dir train/datas/file \
    --batch_size 64 \
    --epochs 200 \
    --lr 1e-4 \
    --warmup_epochs 10 \
    --warmup_lr 1e-6 \
    --scheduler_type cosine \
    --cosine_eta_min 1e-5 \
    --weight_decay 1e-4 \
    --dropout 0.15 \
    --mse_weight 0.1 \
    --cosine_weight 0.9 \
    --use_mixed_precision \
    --early_stopping_patience 25
```

## ðŸ” é¢„æœŸæ”¹è¿›æ•ˆæžœ

### ä½¿ç”¨æ–¹æ¡ˆ1åŽçš„é¢„æœŸæ›²çº¿

1. **å‰10ä¸ªepochï¼ˆWarmupï¼‰**ï¼š
   - å­¦ä¹ çŽ‡ä»Ž1e-6çº¿æ€§å¢žåŠ åˆ°1e-4
   - ç›¸ä¼¼åº¦å¯èƒ½ä¸Šå‡è¾ƒæ…¢ï¼Œä½†æ›´ç¨³å®š

2. **10-40ä¸ªepochï¼ˆCosineå‰æœŸï¼‰**ï¼š
   - å­¦ä¹ çŽ‡åœ¨1e-4é™„è¿‘
   - **ç›¸ä¼¼åº¦åº”è¯¥çªç ´0.75ï¼Œè¾¾åˆ°0.80-0.85**
   - æŸå¤±ç»§ç»­ä¸‹é™

3. **40-150ä¸ªepochï¼ˆCosineåŽæœŸï¼‰**ï¼š
   - å­¦ä¹ çŽ‡å¹³æ»‘è¡°å‡ï¼Œä½†ä¿æŒåœ¨1e-5ä»¥ä¸Š
   - **ç›¸ä¼¼åº¦æœ‰æœ›è¾¾åˆ°0.85-0.90**
   - ç²¾ç»†è°ƒä¼˜é˜¶æ®µ

## âš ï¸ å…³é”®è°ƒæ•´ç‚¹

### 1. æŸå¤±å‡½æ•°æƒé‡ï¼ˆæœ€é‡è¦ï¼‰
- **å½“å‰**ï¼šMSE 0.2, Cosine 0.8
- **å»ºè®®**ï¼šMSE 0.1, Cosine 0.9
- **åŽŸå› **ï¼šç›¸ä¼¼åº¦æ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œéœ€è¦æ›´å¼ºè°ƒ

### 2. æœ€å°å­¦ä¹ çŽ‡
- **å½“å‰**ï¼š1e-6ï¼ˆå¯èƒ½å¤ªå°ï¼‰
- **å»ºè®®**ï¼š1e-5
- **åŽŸå› **ï¼šä¿æŒä¸€å®šçš„æŽ¢ç´¢èƒ½åŠ›ï¼Œé¿å…è¿‡æ—©åœæ­¢å­¦ä¹ 

### 3. Warmupæ—¶é—´
- **å½“å‰**ï¼š5 epochs
- **å»ºè®®**ï¼š10 epochs
- **åŽŸå› **ï¼šç»™æ¨¡åž‹æ›´å¤šæ—¶é—´ç¨³å®šåˆå§‹åŒ–

### 4. è®­ç»ƒè½®æ•°
- **å½“å‰**ï¼š100 epochs
- **å»ºè®®**ï¼š150-200 epochs
- **åŽŸå› **ï¼šçªç ´å¹³å°æœŸéœ€è¦æ›´å¤šæ—¶é—´

## ðŸ“ˆ ç›‘æŽ§é‡ç‚¹

è®­ç»ƒæ—¶é‡ç‚¹å…³æ³¨ï¼š

1. **ä½™å¼¦ç›¸ä¼¼åº¦æ˜¯å¦çªç ´0.75**
   - å¦‚æžœ20ä¸ªepochåŽä»å¡åœ¨0.75 â†’ å°è¯•æ–¹æ¡ˆ2ï¼ˆå¢žåŠ æ¨¡åž‹å®¹é‡ï¼‰
   - å¦‚æžœçªç ´åˆ°0.80+ â†’ ç»§ç»­å½“å‰ç­–ç•¥

2. **è¿‡æ‹Ÿåˆç¨‹åº¦**
   - å¦‚æžœéªŒè¯æŸå¤±/è®­ç»ƒæŸå¤± > 1.5 â†’ å¢žåŠ dropoutå’Œweight_decay
   - å¦‚æžœ < 1.2 â†’ å¯ä»¥é€‚å½“é™ä½Žæ­£åˆ™åŒ–

3. **å­¦ä¹ çŽ‡æ›²çº¿**
   - ç¡®ä¿Warmupé˜¶æ®µå­¦ä¹ çŽ‡çº¿æ€§å¢žé•¿
   - ç¡®ä¿Cosineé˜¶æ®µå¹³æ»‘è¡°å‡ï¼Œä½†ä¸è¦é™å¾—å¤ªå¿«

## ðŸŽ¯ åˆ†é˜¶æ®µä¼˜åŒ–ç­–ç•¥

### é˜¶æ®µ1ï¼šå¿«é€ŸéªŒè¯ï¼ˆä¼˜å…ˆï¼‰
ä½¿ç”¨**æ–¹æ¡ˆ1**ï¼Œè®­ç»ƒ50ä¸ªepochï¼Œè§‚å¯Ÿï¼š
- ç›¸ä¼¼åº¦æ˜¯å¦çªç ´0.75
- å¦‚æžœçªç ´ â†’ ç»§ç»­è®­ç»ƒåˆ°150ä¸ªepoch
- å¦‚æžœæœªçªç ´ â†’ è¿›å…¥é˜¶æ®µ2

### é˜¶æ®µ2ï¼šå¢žåŠ å®¹é‡
ä½¿ç”¨**æ–¹æ¡ˆ2**ï¼Œè®­ç»ƒ100ä¸ªepochï¼Œè§‚å¯Ÿï¼š
- ç›¸ä¼¼åº¦æ˜¯å¦è¾¾åˆ°0.80+
- å¦‚æžœè¾¾åˆ° â†’ ç»§ç»­ä¼˜åŒ–
- å¦‚æžœä»æœªè¾¾åˆ° â†’ æ£€æŸ¥æ•°æ®è´¨é‡

### é˜¶æ®µ3ï¼šç²¾ç»†è°ƒä¼˜
å¦‚æžœç›¸ä¼¼åº¦è¾¾åˆ°0.80+ï¼Œå¯ä»¥ï¼š
- è¿›ä¸€æ­¥é™ä½Žå­¦ä¹ çŽ‡ï¼ˆ1e-5ï¼‰
- å¢žåŠ è®­ç»ƒè½®æ•°ï¼ˆ200+ï¼‰
- å°è¯•ä¸åŒçš„æŸå¤±å‡½æ•°ç»„åˆ

## ðŸ’¡ å…¶ä»–å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘

### 1. ç‰¹å¾è´¨é‡æ£€æŸ¥
- æ£€æŸ¥InsightFaceç‰¹å¾æå–æ˜¯å¦æ­£å¸¸
- éªŒè¯3Då…³é”®ç‚¹å¯¹é½æ˜¯å¦å‡†ç¡®
- æ£€æŸ¥æ•°æ®é›†ä¸­æ˜¯å¦æœ‰å¼‚å¸¸æ ·æœ¬

### 2. æ¨¡åž‹æž¶æž„è°ƒæ•´
- å¦‚æžœç›¸ä¼¼åº¦å§‹ç»ˆæ— æ³•æå‡ï¼Œè€ƒè™‘ï¼š
  - å¢žåŠ æ³¨æ„åŠ›å¤´æ•°ï¼ˆ`--nhead 16`ï¼‰
  - ä½¿ç”¨æ›´æ·±çš„ç½‘ç»œï¼ˆ`--num_layers 8`ï¼‰
  - è°ƒæ•´èžåˆæƒé‡ï¼ˆè®©æ¨¡åž‹å­¦ä¹ æœ€ä¼˜æƒé‡ï¼‰

### 3. æ•°æ®è´¨é‡
- æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä¾§è„¸è§’åº¦è¦†ç›–
- éªŒè¯æ­£é¢å›¾å’Œè§†é¢‘å¸§çš„å¯¹åº”å…³ç³»æ˜¯å¦æ­£ç¡®
- è€ƒè™‘å¢žåŠ æ•°æ®é‡

## ðŸ“Š æˆåŠŸæŒ‡æ ‡

ä¼˜åŒ–åŽçš„ç†æƒ³æ›²çº¿åº”è¯¥æ˜¾ç¤ºï¼š

1. âœ… **ç›¸ä¼¼åº¦æŒç»­ä¸Šå‡**ï¼šä»Ž0.75 â†’ 0.80 â†’ 0.85 â†’ 0.90
2. âœ… **æŸå¤±ç»§ç»­ä¸‹é™**ï¼šè®­ç»ƒæŸå¤± < 0.1ï¼ŒéªŒè¯æŸå¤± < 0.15
3. âœ… **è¿‡æ‹Ÿåˆå¯æŽ§**ï¼šéªŒè¯æŸå¤±/è®­ç»ƒæŸå¤± < 1.5
4. âœ… **ç¨³å®šæ”¶æ•›**ï¼šæ²¡æœ‰å‰§çƒˆéœ‡è¡ï¼Œå¹³æ»‘ä¸‹é™

## ðŸš€ ç«‹å³è¡ŒåŠ¨å»ºè®®

**ç¬¬ä¸€æ­¥**ï¼šä½¿ç”¨æ–¹æ¡ˆ1è®­ç»ƒï¼Œé‡ç‚¹å…³æ³¨å‰50ä¸ªepochçš„ç›¸ä¼¼åº¦å˜åŒ–

**ç¬¬äºŒæ­¥**ï¼šå¦‚æžœç›¸ä¼¼åº¦çªç ´0.75ï¼Œç»§ç»­è®­ç»ƒï¼›å¦‚æžœæœªçªç ´ï¼Œå°è¯•æ–¹æ¡ˆ2

**ç¬¬ä¸‰æ­¥**ï¼šæ ¹æ®å®žé™…æ›²çº¿è¿›ä¸€æ­¥å¾®è°ƒå‚æ•°
